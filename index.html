<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Me On My Way</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');

      :root {
          --bg: #F2EFEA;
          --text: #374151;
          --primary: #6B7051;
          --accent: #A5A58D;
          --card-bg: #FFFFFF;
          --hero-opacity: 0.6;
      }

      .dark {
          --bg: #1A1A1A;
          --text: #E5E7EB;
          --primary: #A5A58D;
          --accent: #B2A27A;
          --card-bg: #2B2B2B;
          --hero-opacity: 0.3;
      }
      
      body {
          background-color: var(--bg);
          color: var(--text);
          transition: background-color 0.3s ease, color 0.3s ease;
      }
      .font-inter {
          font-family: 'Inter', sans-serif;
      }
      .bg-primary { background-color: var(--primary); }
      .text-primary { color: var(--primary); }
      .hover-primary:hover { background-color: var(--primary); }
      .bg-accent { background-color: var(--accent); }
      .text-accent { color: var(--accent); }
      .hover-accent:hover { background-color: var(--accent); }
      .bg-card { background-color: var(--card-bg); }
      .text-card { color: var(--card-bg); }
      .transition-colors-theme {
          transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
      }
      .hero-overlay {
          position: absolute;
          inset: 0;
          background-color: var(--card-bg);
          opacity: var(--hero-opacity);
          transition: opacity 0.3s ease;
      }
      .skip-link {
          position: absolute;
          top: -40px;
          left: 0;
          background: var(--primary);
          color: white;
          padding: 8px;
          z-index: 1000;
          transition: top 0.3s;
          border-radius: 0 0 8px 8px;
      }
      .skip-link:focus {
          top: 0;
      }

      /* Custom styles for mobile swiping */
      .services-container {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          scroll-snap-type: x mandatory;
      }
      .services-container::-webkit-scrollbar {
          display: none;
      }
      .services-container {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
      .service-card {
          scroll-snap-align: center;
          min-width: 80%; /* Make cards take up a good portion of the screen */
      }
    </style>
</head>
<body class="font-inter transition-colors duration-300">
    <!-- Skip to Main Content Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header with Navigation -->
    <header class="p-6 relative z-10">
        <nav class="flex justify-between items-center max-w-5xl mx-auto">
            <button id="theme-toggle" class="p-2 rounded-full transition-transform duration-200 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent">
                <svg id="theme-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                </svg>
            </button>
            <div class="flex items-center space-x-4">
                <a href="#about" class="text-text hover:text-accent transition-colors">About</a>
                <a href="#services" class="text-text hover:text-accent transition-colors">Services</a>
                <a href="#testimonials" class="text-text hover:text-accent transition-colors">Testimonials</a>
                <button id="contact-btn" class="px-4 py-2 bg-accent text-white rounded-lg hover-primary transition-colors-theme">
                    Contact
                </button>
            </div>
        </nav>
    </header>

    <main id="main-content" class="max-w-5xl mx-auto p-6 relative">
        <!-- Hero Section -->
        <section class="relative text-center py-16 px-4">
            <div class="absolute inset-0 z-0">
                <img src="IMG_9988.JPG" alt="A serene landscape with a green field, a path, and mountains in the distance." class="w-full h-full object-cover">
                <div class="hero-overlay"></div>
            </div>
            <div class="relative z-10">
                <h2 class="text-5xl md:text-6xl font-extrabold text-primary leading-tight mb-4">
                    Send Me On My Way
                </h2>
                <p class="text-xl text-text mb-8 max-w-2xl mx-auto">
                    Providing compassionate and holistic support for the dying and their families.
                </p>
                <button id="hero-contact-btn" class="px-8 py-3 bg-accent text-white rounded-lg shadow-lg hover-primary transition-transform duration-200 transform hover:scale-105">
                    Begin Your Journey
                </button>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="py-16 px-4 bg-card rounded-3xl shadow-lg my-12 transition-colors-theme">
            <h3 class="text-4xl font-bold text-center text-primary mb-8">About Jennifer Thomas</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start text-lg text-text leading-relaxed text-center md:text-left">
                <div class="flex justify-center md:justify-end">
                    <img src="IMG_9971.JPG" alt="A side profile of Jennifer Thomas, the death doula, smiling gently." class="w-full max-w-xs h-96 object-cover rounded-xl shadow-md" />
                </div>
                <div>
                    <p class="mt-4 md:mt-0">
                        Hello, I'm Jennifer Thomas, and I am a certified Death Doula dedicated to providing comfort, clarity, and dignity during the final stages of life. I work closely with families to understand their needs, values, and beliefs, providing holistic support that encompasses emotional, spiritual, and practical guidance.
                    </p>
                    <p class="mt-4">
                        My goal is to ensure that the dying person and their loved ones feel supported, heard, and empowered during this challenging time. My extensive training, along with my full-time presence and companionship during vigil and at death, my advocacy, and support for physical, practical, and life review needs, represent a service not widely offered elsewhere.
                    </p>
                </div>
            </div>
            
            <div class="mt-12 text-center">
                <h4 class="font-semibold text-lg text-primary mb-2">My Certifications Include:</h4>
                <ul class="list-disc list-inside text-text space-y-1 w-fit mx-auto">
                    <li>International End of Life Doula Association</li>
                    <li>End of Life Care Specialist/Death Doula</li>
                    <li>University of Georgia, Criminal Justice</li>
                    <li>Reiki 1 & 2 Certified</li>
                    <li>Raindrop Therapy Certified</li>
                    <li>Somatic Mind-Body Healing Practitioner</li>
                </ul>
            </div>
        </section>

        <!-- Services Section -->
        <section id="services" class="py-16 px-4">
            <h3 class="text-4xl font-bold text-center text-primary mb-12">My Services</h3>
            <div class="services-container flex md:grid md:grid-cols-2 gap-8 md:space-y-0 pb-4 snap-x snap-mandatory">
                <!-- Service 1 -->
                <div class="service-card bg-card p-8 rounded-3xl shadow-lg flex flex-col items-center text-center transition-colors-theme">
                    <div>
                        <h4 class="text-2xl font-semibold text-accent mb-4">Mindful Planning</h4>
                        <p class="text-text">Thoughtful guidance for crafting a meaningful farewell, ensuring your wishes are honored with clarity and peace.</p>
                        <ul class="list-disc list-inside text-text mt-4 space-y-1 text-left">
                            <li>Personalized consultations</li>
                            <li>Advance directive assistance</li>
                            <li>Legacy project development</li>
                        </ul>
                    </div>
                    <div>
                        <img src="IMG_9967.png" alt="A person writing in a notebook, with gentle hands helping them." class="rounded-xl w-full h-64 object-cover shadow-md mt-6" />
                    </div>
                </div>
                <!-- Service 2 -->
                <div class="service-card bg-card p-8 rounded-3xl shadow-lg flex flex-col items-center text-center transition-colors-theme">
                    <div>
                        <img src="IMG_9970.JPG" alt="A caring, compassionate person holding the hand of a comforting family member." class="rounded-xl w-full object-cover shadow-md mb-6" />
                    </div>
                    <div>
                        <h4 class="text-2xl font-semibold text-accent mb-4">Compassionate Presence</h4>
                        <p class="text-text">Offering unwavering support and a serene presence during the active dying phase.</p>
                        <ul class="list-disc list-inside text-text mt-4 space-y-1 text-left">
                            <li>Emotional & spiritual support</li>
                            <li>Comfort measures facilitation</li>
                            <li>Family communication liaison</li>
                        </ul>
                    </div>
                </div>
                <!-- Service 3 -->
                <div class="service-card bg-card p-8 rounded-3xl shadow-lg flex flex-col items-center text-center transition-colors-theme">
                    <div>
                        <h4 class="text-2xl font-semibold text-accent mb-4">Journey Through Grief</h4>
                        <p class="text-text">Providing sensitive post-death support to help navigate the complex landscape of loss.</p>
                        <ul class="list-disc list-inside text-text mt-4 space-y-1 text-left">
                            <li>Individual & group sessions</li>
                            <li>Memorial & ritual creation</li>
                            <li>Resource connection</li>
                        </ul>
                    </div>
                    <div>
                        <img src="IMG_9966.JPG" alt="A person looking out a window on a rainy day, in a moment of quiet reflection." class="rounded-xl w-full object-cover shadow-md mt-6" />
                    </div>
                </div>
                <!-- Service 4 -->
                <div class="service-card bg-card p-8 rounded-3xl shadow-lg flex flex-col items-center text-center transition-colors-theme">
                    <div>
                        <img src="womanholdingbook.jpg" alt="A woman in a cozy sweater holding a book, with a focused and serene expression." class="rounded-xl w-full object-cover shadow-md mb-6" />
                    </div>
                    <div>
                        <h4 class="text-2xl font-semibold text-accent mb-4">Holistic Healing</h4>
                        <p class="text-text">Gentle therapies that promote comfort, peace, and spiritual well-being during the end-of-life journey.</p>
                        <ul class="list-disc list-inside text-text mt-4 space-y-1 text-left">
                            <li>Aroma Touch Massage</li>
                            <li>Distance Reiki Sessions</li>
                            <li>Raindrop Therapy</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section id="testimonials" class="py-16 px-4">
            <h3 class="text-4xl font-bold text-center text-primary mb-8">Kind Words</h3>
            <div class="flex justify-center mb-8">
                <button id="add-testimonial-btn" class="px-6 py-2 bg-accent text-white rounded-lg shadow-lg hover-primary transition-transform duration-200 transform hover:scale-105">
                    Add Your Testimonial
                </button>
            </div>
            <div id="testimonials-container" class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                <!-- Testimonials will be loaded here from Supabase -->
                <p class="md:col-span-3 text-center text-text">Loading testimonials...</p>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-primary text-white py-8 transition-colors-theme">
        <div class="max-w-5xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center text-center md:text-left">
            <div class="mb-4 md:mb-0">
                <p>&copy; 2023 Send Me On My Way. All Rights Reserved.</p>
                <p>Designed by AR</p>
            </div>
            <div class="flex flex-col items-center md:items-start mb-4 md:mb-0">
                <p class="italic text-sm max-w-lg mb-2">"Death must be so beautiful. To lie in the soft brown earth, with the grasses waving above one's head, and listen to silence. To have no yesterday, and no tomorrow. To forget time, to forgive life, to be at peace." - Oscar Wilde</p>
            </div>
            <div class="flex space-x-4 items-center">
                <!-- Instagram Icon -->
                <a href="https://www.instagram.com/sendmeonmywaydeathdoula/?igsh=MTUxYTNpd2E1dnkybQ%3D%3D#" target="_blank" rel="noopener noreferrer" class="hover:text-gray-300 transition-colors">
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                        <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
                    </svg>
                    <span class="sr-only">Instagram</span>
                </a>
                <!-- Facebook Icon -->
                <a href="https://www.facebook.com/people/Jennifer-Thomas-Death-Doula/100091771513742" target="_blank" rel="noopener noreferrer" class="hover:text-gray-300 transition-colors">
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14 13h-2.5v7h-3v-7h-2v-3h2v-2c0-2.3 1.25-3.5 3.5-3.5h2v3h-2c-1.125 0-1.5.25-1.5 1.5v1h3.5l-.5 3z"></path>
                    </svg>
                    <span class="sr-only">Facebook</span>
                </a>
            </div>
        </div>
    </footer>

    <!-- Contact Form Modal -->
    <div id="contact-modal" class="fixed inset-0 bg-gray-950 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden" aria-modal="true">
        <div class="bg-card rounded-xl shadow-2xl p-8 max-w-lg w-full transition-colors-theme">
            <div class="flex justify-between items-center mb-6">
                <h4 class="text-2xl font-bold text-primary">Contact Us</h4>
                <button id="close-contact-modal-btn" class="text-gray-500 hover:text-gray-800 dark:hover:text-gray-300">&times;</button>
            </div>
            <div id="contact-submission-message" class="text-center text-lg font-semibold my-6 hidden"></div>
            <form id="contact-form" class="space-y-4">
                <div>
                    <label for="name" class="block text-text font-semibold mb-1">Name</label>
                    <input type="text" id="name" name="name" class="w-full px-4 py-2 border border-gray-300 bg-gray-100 dark:bg-gray-700 text-text rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" required>
                </div>
                <div>
                    <label for="email" class="block text-text font-semibold mb-1">Email</label>
                    <input type="email" id="email" name="email" class="w-full px-4 py-2 border border-gray-300 bg-gray-100 dark:bg-gray-700 text-text rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" required>
                </div>
                <div>
                    <label for="message" class="block text-text font-semibold mb-1">Message</label>
                    <textarea id="message" name="message" rows="4" class="w-full px-4 py-2 border border-gray-300 bg-gray-100 dark:bg-gray-700 text-text rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" required></textarea>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancel-contact-btn" class="px-6 py-2 rounded-lg text-text hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors-theme">
                        Cancel
                    </button>
                    <button type="submit" id="submit-contact-btn" class="px-6 py-2 bg-accent text-white rounded-lg hover-primary transition-colors-theme">
                        Send Message
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Testimonial Form Modal -->
    <div id="testimonial-modal" class="fixed inset-0 bg-gray-950 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden" aria-modal="true">
        <div class="bg-card rounded-xl shadow-2xl p-8 max-w-lg w-full transition-colors-theme">
            <div class="flex justify-between items-center mb-6">
                <h4 class="text-2xl font-bold text-primary">Add Your Testimonial</h4>
                <button id="close-testimonial-modal-btn" class="text-gray-500 hover:text-gray-800 dark:hover:text-gray-300">&times;</button>
            </div>
            <div id="testimonial-submission-message" class="text-center text-lg font-semibold my-6 hidden"></div>
            <form id="testimonial-form" class="space-y-4">
                <div>
                    <label for="testimonial-quote" class="block text-text font-semibold mb-1">Your Testimonial</label>
                    <textarea id="testimonial-quote" name="quote" rows="4" class="w-full px-4 py-2 border border-gray-300 bg-gray-100 dark:bg-gray-700 text-text rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" required></textarea>
                </div>
                <div>
                    <label for="testimonial-author" class="block text-text font-semibold mb-1">Your Name</label>
                    <input type="text" id="testimonial-author" name="author" class="w-full px-4 py-2 border border-gray-300 bg-gray-100 dark:bg-gray-700 text-text rounded-lg focus:outline-none focus:ring-2 focus:ring-accent" required>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancel-testimonial-btn" class="px-6 py-2 rounded-lg text-text hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors-theme">
                        Cancel
                    </button>
                    <button type="submit" id="submit-testimonial-btn" class="px-6 py-2 bg-accent text-white rounded-lg hover-primary transition-colors-theme">
                        Submit Testimonial
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scroll to Top Button -->
    <button id="scrollToTopBtn" aria-label="Scroll to top" class="fixed bottom-8 right-8 bg-primary text-white p-4 rounded-full shadow-lg transition-transform duration-300 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent z-50 hidden">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
        </svg>
    </button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Supabase configuration and initialization
            const supabaseUrl = 'https://zmjrlezcjwolzvvzglvi.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InptanJsZXpjandvbHp2dnpnbHZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5MTQ4NTQsImV4cCI6MjA3MjQ5MDg1NH0.JRcNdAUC4ZLB7bCLwXEXeyr_sV2nQ7k_XY11TV_AooU';

            let supabaseClient = null;
            
            const loadSupabase = () => {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                document.body.appendChild(script);

                script.onload = () => {
                    if (window.supabase && window.supabase.createClient) {
                        supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
                        console.log('Supabase: Ready');
                        fetchTestimonials();
                    } else {
                        console.error('Supabase: Error - library not found after loading script.');
                    }
                };
            };
            
            // Theme toggle functionality
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const body = document.body;

            const setLightMode = () => {
                body.classList.remove('dark');
                themeIcon.innerHTML = `<path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>`;
            };

            const setDarkMode = () => {
                body.classList.add('dark');
                themeIcon.innerHTML = `<path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>`;
            };

            const toggleTheme = () => {
                const isDark = body.classList.contains('dark');
                if (isDark) {
                    setLightMode();
                    localStorage.setItem('theme', 'light');
                } else {
                    setDarkMode();
                    localStorage.setItem('theme', 'dark');
                }
            };
            
            // Set initial theme based on localStorage or system preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                if (savedTheme === 'dark') {
                    setDarkMode();
                } else {
                    setLightMode();
                }
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setDarkMode();
            } else {
                setLightMode();
            }

            themeToggleBtn.addEventListener('click', toggleTheme);
            
            // Modal logic
            const contactModal = document.getElementById('contact-modal');
            const testimonialModal = document.getElementById('testimonial-modal');
            const focusableElements = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';

            const trapFocus = (modal) => {
                const focusable = Array.from(modal.querySelectorAll(focusableElements));
                if (focusable.length === 0) return;
                const firstFocusable = focusable[0];
                const lastFocusable = focusable[focusable.length - 1];

                modal.addEventListener('keydown', (e) => {
                    const isTabPressed = (e.key === 'Tab');
                    if (!isTabPressed) return;

                    if (e.shiftKey) { // Shift + Tab
                        if (document.activeElement === firstFocusable) {
                            lastFocusable.focus();
                            e.preventDefault();
                        }
                    } else { // Tab
                        if (document.activeElement === lastFocusable) {
                            firstFocusable.focus();
                            e.preventDefault();
                        }
                    }
                });
                firstFocusable.focus();
            };

            const showModal = (modal) => {
                modal.classList.remove('hidden');
                trapFocus(modal);
                const form = modal.querySelector('form');
                const messageDiv = modal.querySelector('div[id$="-submission-message"]');
                if (form) form.classList.remove('hidden');
                if (messageDiv) messageDiv.classList.add('hidden');
            };

            const hideModal = (modal) => {
                modal.classList.add('hidden');
            };

            // Event listeners for modal buttons
            document.getElementById('contact-btn').addEventListener('click', () => showModal(contactModal));
            document.getElementById('hero-contact-btn').addEventListener('click', () => showModal(contactModal));
            document.getElementById('close-contact-modal-btn').addEventListener('click', () => hideModal(contactModal));
            document.getElementById('cancel-contact-btn').addEventListener('click', () => hideModal(contactModal));
            document.getElementById('add-testimonial-btn').addEventListener('click', () => showModal(testimonialModal));
            document.getElementById('close-testimonial-modal-btn').addEventListener('click', () => hideModal(testimonialModal));
            document.getElementById('cancel-testimonial-btn').addEventListener('click', () => hideModal(testimonialModal));

            // Form submission handlers
            document.getElementById('contact-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const contactForm = e.target;
                const contactSubmissionMessageDiv = document.getElementById('contact-submission-message');
                const submitContactBtn = document.getElementById('submit-contact-btn');

                if (!supabaseClient) {
                    contactSubmissionMessageDiv.textContent = 'Supabase is not ready yet. Please try again.';
                    contactSubmissionMessageDiv.classList.remove('hidden');
                    return;
                }
                
                const formData = {
                    name: contactForm.name.value,
                    email: contactForm.email.value,
                    message: contactForm.message.value
                };

                submitContactBtn.textContent = 'Sending...';
                submitContactBtn.disabled = true;

                try {
                    const { error } = await supabaseClient.from('contact_messages').insert([formData]);
                    if (error) throw error;
                    contactSubmissionMessageDiv.textContent = 'Thank you for your message! We will be in touch shortly.';
                    contactForm.reset();
                    contactForm.classList.add('hidden');
                } catch (error) {
                    console.error('Error submitting contact form:', error.message);
                    contactSubmissionMessageDiv.textContent = 'Failed to send message. Please try again later.';
                } finally {
                    contactSubmissionMessageDiv.classList.remove('hidden');
                    submitContactBtn.textContent = 'Send Message';
                    submitContactBtn.disabled = false;
                }
            });

            document.getElementById('testimonial-form').addEventListener('submit', async (e) => {
                e.preventDefault();

                const testimonialForm = e.target;
                const testimonialSubmissionMessageDiv = document.getElementById('testimonial-submission-message');
                const submitTestimonialBtn = document.getElementById('submit-testimonial-btn');

                if (!supabaseClient) {
                    testimonialSubmissionMessageDiv.textContent = 'Supabase is not ready yet. Please try again.';
                    testimonialSubmissionMessageDiv.classList.remove('hidden');
                    return;
                }

                const formData = {
                    quote: testimonialForm.quote.value,
                    author: testimonialForm.author.value
                };

                submitTestimonialBtn.textContent = 'Submitting...';
                submitTestimonialBtn.disabled = true;

                try {
                    const { error } = await supabaseClient.from('testimonials').insert([formData]);
                    if (error) throw error;
                    testimonialSubmissionMessageDiv.textContent = 'Thank you! Your testimonial has been submitted.';
                    testimonialForm.reset();
                    testimonialForm.classList.add('hidden');
                    fetchTestimonials();
                } catch (error) {
                    console.error('Error submitting testimonial:', error.message);
                    testimonialSubmissionMessageDiv.textContent = 'Failed to submit testimonial. Please try again.';
                } finally {
                    testimonialSubmissionMessageDiv.classList.remove('hidden');
                    submitTestimonialBtn.textContent = 'Submit Testimonial';
                    submitTestimonialBtn.disabled = false;
                }
            });

            // Testimonial fetching and rendering
            const fetchTestimonials = async () => {
                const testimonialsContainer = document.getElementById('testimonials-container');
                testimonialsContainer.innerHTML = '<p class="md:col-span-3 text-center text-text">Loading testimonials...</p>';

                if (!supabaseClient) {
                    setTimeout(fetchTestimonials, 500);
                    return;
                }
                
                try {
                    const { data, error } = await supabaseClient.from('testimonials').select('*');
                    if (error) throw error;

                    if (data.length > 0) {
                        testimonialsContainer.innerHTML = '';
                        data.forEach(testimonial => {
                            const card = document.createElement('div');
                            card.className = 'bg-card p-6 rounded-3xl shadow-lg flex flex-col items-center text-center transition-colors-theme';
                            card.innerHTML = `
                                <p class="italic text-base text-text mb-4">"${testimonial.quote}"</p>
                                <p class="font-semibold text-accent">- ${testimonial.author}</p>
                            `;
                            testimonialsContainer.appendChild(card);
                        });
                    } else {
                        testimonialsContainer.innerHTML = '<p class="md:col-span-3 text-center text-text">No testimonials to display yet.</p>';
                    }
                } catch (error) {
                    console.error('Error fetching testimonials:', error.message);
                    testimonialsContainer.innerHTML = `<p class="md:col-span-3 text-center text-red-500">Failed to load testimonials: ${error.message}</p>`;
                }
            };
            
            // Scroll to Top Button
            const scrollToTopBtn = document.getElementById('scrollToTopBtn');
            const SCROLL_THRESHOLD = 300;

            window.addEventListener('scroll', () => {
                if (window.scrollY > SCROLL_THRESHOLD) {
                    scrollToTopBtn.classList.remove('hidden');
                } else {
                    scrollToTopBtn.classList.add('hidden');
                }
            });

            scrollToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // Initial setup
            loadSupabase();
        });
    </script>
</body>
</html>
